<link rel="stylesheet" type="text/css" href="../report.css"/>

<script type="text/javascript" src="../js.js"></script>
<script type="text/javascript" src="/multibooker/metronic/admin/template_content/assets/plugins/jquery-1.10.2.min.js"></script>
<style>

 @media screen {
    #report{
        display: none;
    }

 }
@media print {
  #report{
      display: block;
  }
  
  table tr.th {
    background: #ccc;
  }
}


@media print{
  .btn.print {
    display: none;
  }
}

table {
  width: 100%;
  border-collapse:collapse !important;
}
table td{
  padding: 1px 2px;
  border: 1px solid;
}

table tr.th {
  min-width: 100px;
  text-align: center;
}
table th {
  border: 1px solid;
  background: #ccc;
}

table tr.tBody {

}

table td.col_2,table td.col_6 {
  text-align: right;
}
table td.col_3,table td.col_5 {
  text-align: center;
}

table tr.tableHead td,table tr.tableEnd td {
  padding: 5px 0;
  font-weight: bold;
  border: none;
}
</style>

<script>

$_GET = GET();
var params = {};
for (key in $_GET){
  if(key!="subcommand" && key!="sid"){
    params[key] = $_GET[key];
  }
}


$(document).ready(function(){
    var subcommand = $_GET['subcommand'];  
    send_query({command:"get",object:subcommand,sid:$_GET['sid'],params:params},function(result){
        //var tables = xmlToObject(result,"REPORT_TABLE");
        // var xml = xmlToObject(result,"LINE");
        
        var html = '';
        html+= ''+
        '<div class="report">'+
          '<div>'+
            '<center><b>'+$(result).find('LINE_1').text()+'</b></center>'+
            '<b>'+$(result).find('LINE_2').text()+'</b>'+
            '<p><b>'+$(result).find('LINE_3').text()+'</b></p>'+
            '<p><b>'+$(result).find('LINE_4').text()+'</b></p><br/>'+
            '<p>'+$(result).find('LINE_5').text()+'</p>'+
          '</div>'+
          '<table>';
            $(result).find("REPORT_TABLE").each(function(){
                var thisTable = $(this);
                thisTable.find("TABLE_HEAD").each(function(){
                  html+= "<tr class='tableHead'>";
                  html+= "<td>"+$(this).find("HEAD_LABEL").text()+"</td>";
                  html+= "<td colspan='5'>"+$(this).find("HEAD_VALUE").text()+"</td>";
                  html+= "</tr>";
                });
                thisTable.find("TABLE_BODY").each(function(){
                  var thisBody = $(this);
                  html+= ''+
                  '<tr class="th">'+
                    '<td>Секция</td><td>Цена</td><td>Ряд</td><td>Места</td><td>Кол-во</td><td>Сумма</td>'+
                  '</tr>';
                  thisBody.find("LINE").each(function(){
                    var thisLINE = $(this);
                    var counter = 1;
                    html+= "<tr>";
                    thisLINE.find("COLUMN").each(function(){
                      html+= "<td class=col_"+counter+">"+$(this).text()+"</td>";
                      counter++;
                    })
                    html+= "</tr>";
                  })
                  
                });
                thisTable.find("TABLE_END").each(function(){
                  html+= "<tr class='tableEnd'>";
                  html+= "<td colspan='2'> Итого по мероприятию </td>";
                  html+= "<td colspan='2'>Всего мест "+$(this).find("TOTAL_PLACE_COUNT").text()+"</td>";
                  html+= "<td> На сумму </td>";
                  html+= "<td>"+$(this).find("TOTAL_PLACE_AMOUNT").text()+"</td>";
                  html+= "</tr>";
                  html+= "<tr class='tableEnd'>";
                  html+= "<td colspan='6'><b>"+$(this).find("TOTAL_PLACE_AMOUNT_STR").text()+"</b></td>";
                  html+= "</tr>";
                  html+= "<tr class='tableEnd'>";
                  html+= "<td colspan='6'>По номиналу "+$(this).find("TOTAL_PLACE_AMOUNT_STR").text()+"</td>";
                  html+= "</tr>";
                });

            })
          html+= ''+
          '</table>'+
          '<p><b>Сдал: '+$(result).find("GET_BY").text()+'</b></p>'+
          '<p><b>Принял:</b></p>'+
        '</div>';

        $("#report").html(html);
        window.print();
    });
});


</script>


<div id="report">

</div>