<link rel="stylesheet" type="text/css" href="../report.css"/>
<link href="/multibooker/metronic/admin/template_content/assets/plugins/bootstrap-toastr/toastr.min.css" rel="stylesheet" type="text/css"/>



<script type="text/javascript" src="/multibooker/metronic/admin/template_content/assets/plugins/jquery-1.10.2.min.js"></script>
<script src="/multibooker/metronic/admin/template_content/assets/plugins/jquery.cokie.min.js" type="text/javascript"></script>

<script src="/multibooker/metronic/admin/template_content/assets/plugins/bootstrap-toastr/toastr.min.js"></script>



<script type="text/javascript" src="../js.js"></script>
<script src="/multibooker/assets/js/main.js"></script>
<style>

 @media screen {
    #report{
        display: none;
    }

 }
@media print {
  #report{
      display: block;
  }
  
  table tr.th {
    background: #ccc;
  }
}


@media print{
  .btn.print {
    display: none;
  }
}

table {
  width: 100%;
  border-collapse:collapse !important;
}
table td{
  padding: 1px 2px;
  border: 1px solid;
}

table tr.th {
  min-width: 100px;
  text-align: center;
  font-weight: bold;
  background: #ccc;
}

table th {
  border: 1px solid;
  background: #ccc;
}

table tr.tBody {

}

table td.col_2 {
  text-align: center;
}
table td.col_3,table td.col_4 {
  text-align: right;
}

table tr.tableHead td{
  padding: 1px 0;
  font-weight: bold;
  border: none;
}
table tr.tableEnd {
  border: 1px solid;
}
table tr.tableEnd td {
  font-weight: bold;
  border: none;
}
</style>

<script>

$_GET = GET();
var params = {};
for (key in $_GET){
  if(key!="subcommand" && key!="sid"){
    params[key] = $_GET[key];
  }
}


$(document).ready(function(){
    var subcommand = $_GET['subcommand']; 
    send_query({command:"get",object:subcommand,sid:$_GET['sid'],params:params},function(result){
        //var tables = xmlToObject(result,"REPORT_TABLE");
        // var xml = xmlToObject(result,"LINE");
        result = parseResult(result);
        console.log(result);
        var html = '';
        html+= ''+
        '<div class="report">'+
          '<div>'+
            '<div class="right">'+$(result).find('LINE_1').text()+'</div>'+
            ''+$(result).find('LINE_2').text()+'<br><br>'+
            '<center>'+$(result).find('LINE_3').text()+'</center>'+
            '<center><b>'+$(result).find('LINE_4').text()+'</b></center>'+
            '<p>'+$(result).find('LINE_5').text()+'</p>'+
            '<p><b>'+$(result).find('LINE_6').text()+'</b></p>'+
            '<p><b>'+$(result).find('LINE_7').text()+'</b></p>'+
          '</div>';
            $(result).find("REPORT_TABLE").each(function(){
                var thisTable = $(this);
                thisTable.find("TABLE_HEAD").each(function(){
                  html+= "<table>";
                  html+= "<tr class='tableHead'>";
                  html+= "<td>"+$(this).find("HEAD_LINE1").text()+"</td>";
                  html+= "</tr>"
                  html+= "<tr class='tableHead'>";
                  html+= "<td>"+$(this).find("HEAD_LINE2").text()+"</td>";
                  html+= "</tr>";
                  html+= "<tr class='tableHead'>";
                  html+= "<td>"+$(this).find("HEAD_LINE3").text()+"</td>";
                  html+= "</tr>";
                  html+= "</table>";
                });
                thisTable.find("TABLE_BODY").each(function(){
                  var thisBody = $(this);
                  html+= ''+
                  '<br><table>'+
                  '<tr class="th">'+
                    '<td rowspan="2"> Название секции </td>'+
                    '<td colspan="3"> Возвращено билетов </td>'+
                  '</tr>'+
                  '<tr class="th">'+
                    '<td>Кол-во</td><td>цена</td><td>сумма</td>'+
                  '</tr>';

                  thisBody.find("LINE").each(function(){
                    var thisLINE = $(this);
                    var counter = 1;
                    html+= "<tr>";
                    thisLINE.find("COLUMN").each(function(){
                      html+= "<td class=col_"+counter+">"+$(this).text()+"</td>";
                      counter++;
                    })
                    html+= "</tr>";
                  })
                  
                });
                thisTable.find("TABLE_END").each(function(){
                  html+= "<tr class='tableEnd'>";
                  html+= "<td align='right'> ВСЕГО:</td>";
                  html+= "<td align='center'>"+$(this).find("TOTAL_TICKET_COUNT").text()+"</td>";
                  html+= "<td colspan='2' align='right'>"+$(this).find("TOTAL_AMOUNT").text()+"</td>";
                  html+= "</tr>";
                });

            })
          html+= ''+
          '</table>'+
          '<p><b>Сдал: '+$(result).find("GET_BY").text()+'</b></p>'+
          '<p><b>Принял:___________________________</b></p>'+
        '</div>';

        $("#report").html(html);
        window.print();
    });
});


</script>


<div id="report">

</div>